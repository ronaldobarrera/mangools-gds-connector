#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("connect");
var auth_1 = require("./auth");
var commands_1 = require("./commands");
var utils_1 = require("./utils");
var commander = require('commander');
// CLI
/**
 * Set global CLI configurations
 */
commander
    .usage("<command> [options]")
    .description(utils_1.PROJECT_NAME + " - The Apps Script CLI");
/**
 * Logs the user in. Saves the client credentials to an rc file.
 * @name login
 * @param {string?} [--no-localhost] Do not run a local server, manually enter code instead.
 * @param {string?} [--creds] Relative path to credentials (from GCP).
 * @example login (uses default clasp credentials)
 * @example login --creds credentials.json (uses your credentials file).
 * @see test
 */
commander
    .command('login')
    .description('Log in to script.google.com')
    .option('--no-localhost', 'Do not run a local server, manually enter code instead')
    .option('--creds <file>', 'Relative path to credentials (from GCP).')
    .action(auth_1.login);
/**
 * Logs out the user by deleteing client credentials.
 * @name logout
 * @example logout
 */
commander
    .command('logout')
    .description('Log out')
    .action(commands_1.logout);
/**
 * Creates a new script project.
 * @name create
 * @param {string?} [scriptTitle] An optional project title.
 * @param {string?} [scriptParentId] An optional project parent Id. The Drive ID of a parent file
 *   that the created script project is bound to. This is usually the ID of a
 *   Google Doc, Google Sheet, Google Form, or Google Slides file. If not set, a
 *   standalone script project is created.
 * @example create
 * @example create "My Script"
 * @example create "My Script" "1D_Gxyv*****************************NXO7o"
 * @see https://developers.google.com/apps-script/api/reference/rest/v1/projects/create
 */
commander
    .command('create [scriptTitle] [scriptParentId]')
    .description('Create a script')
    .action(commands_1.create);
/**
 * Fetches a project and saves the script id locally.
 * @param {string?} [scriptId] The script ID to clone.
 * @param {string?} [versionNumber] The version of the script to clone.
 */
commander
    .command('clone [scriptId] [versionNumber]')
    .description('Clone a project')
    .action(commands_1.clone);
/**
 * Fetches a project from either a provided or saved script id.
 * Updates local files with Apps Script project.
 * @name pull
 * @example pull
 */
commander
    .command('pull')
    .description('Fetch a remote project')
    .action(commands_1.pull);
/**
 * Force writes all local files to the script management server.
 * @name push
 * @desc Ignores files:
 * - That start with a .
 * - That don't have an accepted file extension
 * - That are ignored (filename matches a glob pattern in the ignore file)
 * @example push
 * @example push --watch
 */
commander
    .command('push')
    .description('Update the remote project')
    .option('--watch', 'Watches for local file changes. Pushes when a non-ignored file changs.')
    .action(commands_1.push);
/**
 * Lists files that will be written to the server on `push`.
 * @name status
 * @desc Ignores files:
 * - That start with a .
 * - That don't have an accepted file extension
 * - That are ignored (filename matches a glob pattern in the ignore file)
 * @example status
 */
commander
    .command('status')
    .description('Lists files that will be pushed by clasp')
    .option('--json', 'Show status in JSON form')
    .action(commands_1.status);
/**
 * Opens the `clasp` project on script.google.com. Provide a `scriptId` to open a different script.
 * @name open
 * @param {string?} [scriptId] The optional script project to open.
 * @example open
 * @example open [scriptId]
 */
commander
    .command('open [scriptId]')
    .description('Open a script')
    .option('--webapp', 'Open web application in browser')
    .action(commands_1.openCmd);
/**
 * List deployments of a script
 * @name deployments
 * @example deployments
 */
commander
    .command('deployments')
    .description('List deployment ids of a script')
    .action(commands_1.deployments);
/**
 * Creates a version and deploys a script.
 * The response gives the version of the deployment.
 * @name deploy
 * @param {number} [version] The version number.
 * @param {string} [description] The deployment description.
 * @example deploy
 * @example deploy 4
 * @example deploy 7 "Updates sidebar logo."
 */
commander
    .command('deploy [version] [description]')
    .description('Deploy a project')
    .action(commands_1.deploy);
/**
 * Undeploys a deployment of a script.
 * @name undeploy
 * @param {string} deploymentId The deployment ID.
 * @example "undeploy 123"
 */
commander
    .command('undeploy <deploymentId>')
    .description('Undeploy a deployment of a project')
    .action(commands_1.undeploy);
/**
 * Updates deployments of a script.
 * @name redeploy
 * @param {number} deploymentId The deployment ID.
 * @param {number} version The target deployment version.
 * @param {string} description The reason why the script was redeployed.
 * @example redeploy 123 3 "Why I updated the deployment"
 */
commander
    .command('redeploy <deploymentId> <version> <description>')
    .description("Update a deployment")
    .action(commands_1.redeploy);
/**
 * List versions of a script.
 * @name versions
 * @example versions
 */
commander
    .command('versions')
    .description('List versions of a script')
    .action(commands_1.versions);
/**
 * Creates an immutable version of the script.
 * @name version
 * @param {string?} description The description of the script version.
 * @example version
 * @example version "Bump the version."
 */
commander
    .command('version [description]')
    .description('Creates an immutable version of the script')
    .action(commands_1.version);
/**
 * Lists your most recent 10 Apps Script projects.
 * @name list
 * @example list # helloworld1 â€“ xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx ...
 * @todo Add --all flag to list all projects.
 */
commander
    .command('list')
    .description('List App Scripts projects')
    .action(commands_1.list);
/**
 * Prints out 5 most recent the StackDriver logs.
 * @name logs
 * @param {boolean?} json Output logs in json format.
 * @param {boolean?} open Open StackDriver logs in a browser.
 */
commander
    .command('logs')
    .description('Shows the StackDriver logs')
    .option('--json', 'Show logs in JSON form')
    .option('--open', 'Open the StackDriver logs in browser')
    .action(commands_1.logs);
/**
 * Remotely executes an Apps Script function.
 * This function runs your script in the cloud. You must supply
 * the functionName params. For now, it can
 * only run functions that do not require other authorization.
 * @name run
 * @param {string} functionName The function in the script that you want to run.
 * @example run 'sendEmail'
 * @see https://developers.google.com/apps-script/api/reference/rest/v1/scripts/run
 * @requires `clasp login --ownkey` to be run beforehand.
 */
commander
    .command('run <functionName>')
    .description('Run a function in your Apps Scripts project')
    .action(commands_1.run);
/**
 * List, enable, or disable APIs for your project.
 * Currently, only list is supported.
 * @name apis
 * @example apis list
 * @example apis enable "drive.googleapis.com"
 */
commander
    .command('apis')
    .description('List, enable, or disable apis')
    .action(commands_1.apis);
/**
 * Displays the help function.
 * @name help
 * @example help
 */
commander
    .command('help')
    .description('Display help')
    .action(commands_1.help);
/**
 * Displays clasp version
 */
commander
    .version(require('../package.json').version, '-v, --version');
/**
 * All other commands are given a help message.
 * @example random
 */
commander
    .command('*', { isDefault: true })
    .description('Any other command is not supported')
    .action(commands_1.defaultCmd);
// defaults to help if commands are not provided
if (!process.argv.slice(2).length) {
    commander.outputHelp();
}
// User input is provided from the process' arguments
commander.parse(process.argv);
